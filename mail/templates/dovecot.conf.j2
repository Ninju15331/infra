# Managed by infra repo â€” {{ instance_name }}
dovecot_config_version = 2.4.2
dovecot_storage_version = 2.4.2
mail_debug = no
protocols = imap pop3

auth_verbose = yes
auth_mechanisms = plain login

service auth {
  unix_listener /var/spool/postfix/private/auth {
    mode = 0660
    user = postfix
    group = postfix
  }
  unix_listener auth-userdb {
    mode = 0600
    user = postfix
    group = postfix
  }
}

service imap-login {
  inet_listener imap {
    listen = {{ instance.dovecot_listen }}
  }
  inet_listener imaps {
    listen = {{ instance.dovecot_listen }}
  }
}

service pop3-login {
  inet_listener pop3 {
    listen = {{ instance.dovecot_listen }}
  }
  inet_listener pop3s {
    listen = {{ instance.dovecot_listen }}
  }
}

mail_driver = maildir
mail_path = ~/

passdb passwd-file {
  passwd_file_path = /etc/dovecot/virtual-users
}

userdb static {
  fields {
    uid=postfix
    gid=postfix
    home=/mail/%{user | domain}/%{user | username}
  }
}

ssl_server_cert_file = /etc/ssl/certs/{{ common.cert_domain }}.crt
ssl_server_key_file = /etc/ssl/private/{{ common.cert_domain }}.key

first_valid_uid = 73

ssl = required
ssl_min_protocol = TLSv1.2
ssl_cipher_list = ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305
